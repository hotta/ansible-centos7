---
- name: roles/php/tasks/main.yml
  command: echo

- name: Install PHP dependencies from remiXX
  yum:
    enablerepo: remi,remi-{{ PHP_REPO }
    name: 
      - php
      - php-mbstring
      - php-cli
      - php-xml
      - php-pdo
      - php-pgsql
      - php-pecl-zip
      - php-gd
      - php-intl
      - php-mysqlnd
      - php-mcrypt
      - php-process
      - php-fpm
  become: yes

- name: Install php-mcrypt
  yum:
    enablerepo: remi,remi-remi56
    name: 
      - php-mcrypt
  become: yes
  when: PHP_REPO == remi56

- name: Install php-bcmath
  yum:
    enablerepo: remi,remi-{{ PHP_REPO }}
    name: 
      - php-bcmath
  become: yes
  when: PHP_REPO == "remi72" or PHP_REPO == "remi73" or PHP_REPO == "remi74"

- name: php.ini - date.timezone
  lineinfile:
    dest:         "{{ PHP_INI_DIR }}/php.ini"
    regexp:       "^;date.timezone ="
    line:         "date.timezone = {{ TIME_ZONE }}"
  become: yes

- name: php.ini - mbstring.language
  lineinfile:
    dest:         "{{ PHP_INI_DIR }}/php.ini"
    regexp:       "^;mbstring.language = Japanese"
    line:         "mbstring.language = Japanese"
  become: yes
  when:           TIME_ZONE == 'Asia/Tokyo'

- name: Reset owner for WWW_BASE
  file:
    path: "{{ WWW_BASE }}"
    state:    directory
    owner:    "{{ ansible_user_id }}"
  become: yes
